<html>
 <head>
 <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimumscale=1,
 maximum-scale=1">
 
  


 
  
  
 
<!-- BEGIN LivePerson Monitor. -->
<script type="text/javascript">window.lpTag=window.lpTag||{},"undefined"==typeof window.lpTag._tagCount?(window.lpTag={site:'68283988'||"",section:lpTag.section||"",tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{domain : 'lptag-a.liveperson.net',tagjs : 'tags-a.liveperson.net'},_v:"1.8.0",_tagCount:1,protocol:"https:",events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0==e?(this._defB=this._defB||[],this._defB.push(t)):1==e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+"//"+(this.ovr&&this.ovr.domain?this.ovr.domain:"lptag.liveperson.net")+"/tag/tag.js?site="+this.site);var a=document.createElement("script");a.setAttribute("charset",e?e:"UTF-8"),i&&a.setAttribute("id",i),a.setAttribute("src",n),document.getElementsByTagName("head").item(0).appendChild(a)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent("onload",function(){t._domReady("domReady")}):(window.addEventListener("DOMContentLoaded",function(){t._domReady("contReady")},!1),window.addEventListener("load",function(){t._domReady("domReady")},!1)),"undefined"==typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger("LPT","DOM_READY",{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],hooks:lpTag.hooks||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;</script>
<!-- END LivePerson Monitor. -->
 
 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>



  
 
 
 <title>Test TIM</title>
 
 <style>
   
 .web-button {
    background-color: #f68a1f;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
	  border-radius: 4px;
	  -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
}
.web-button:hover {
    background-color: #da7009;
    color: white;	
}
	
.web-button:disabled,
.web-button[disabled]{
  background-color: #f68a1f;
  opacity: 0.5;
}
   
 </style>
 </head>
 <body>
  

 
  
  
  
  


  
  <script>
	  
  function showResult(){
	  if(sessionWebChat){
		  alert("We have a session!!");
	  }
	  alert("We have " + numberMessages + " messages");

  }
	  


  
  function countMessages(){
	  var refreshIntervalId1 = setInterval(function(){
		  var myEle = document.getElementsByClassName("lp_visitor");
		  if(myEle){
			  numberMessages = myEle.length;
			  console.log(numberMessages + " messages");
			  clearInterval(refreshIntervalId1);
		  }
	  }, 1000);
  }

      

   
   
   function ButtonClicked(){

	   var refreshIntervalId1;
	   var refreshIntervalId2;
	   var refreshIntervalId3;
	   var refreshIntervalId4;

	   var myClose;
	   var mySend;
	   var consumerMessages;
	   var myConfirmation;
	   var myRefuse;
	   
	   refreshIntervalId1 = setInterval(function(){
		   myClose = document.getElementsByClassName("lp_close")[0];
		   if(myClose){
			   clearInterval(refreshIntervalId1);
			   $('.lp_close').click(function(){
				   setTimeout(function(){
				   	var xyz = document.getElementsByClassName("lp_close");
				   	if(xyz.length > 0){
					   	console.log("conversation started");
						refreshIntervalId3 = setInterval(function(){
							myConfirmation = document.getElementsByClassName("lp_confirm_button");
							if(myConfirmation){
								clearInterval(refreshIntervalId3);
								showResult();
							}
						}, 100);
						refreshIntervalId4 = setInterval(function(){
							myRefuse = document.getElementsByClassName("lp_cancel_button");
							if(myRefuse){
								clearInterval(refreshIntervalId4);
								startMonitoring();
							}
						}, 100);
				   	} else{
					   	console.log("conversation not started");
						startMonitoring();
				   	}
				   }, 1000);
				   console.log("close clicked");
				   
			   });
		   }
	   }, 100);
	   
	   refreshIntervalId2 = setInterval(function(){
		   mySend = document.getElementsByClassName("lp_send_button")[0];
		   if(mySend){
			   clearInterval(refreshIntervalId2);
			   $('.lp_send_button').click(function(){
				   console.log("sending message");
				   countMessages();
			   });
			   setTimeout(function(){
				   consumerMessages = document.getElementsByClassName("lp_visitor");
				   if(consumerMessages){
					   numberMessages = consumerMessages.length;
				   } else{
					   numberMessages = 0;
				   }
				   console.log(numberMessages + " messages");
			   }, 1000);
		   }
	   }, 100);
	   

   }
      


   function startMonitoring(){
	   
	   var refreshIntervalId1;
	   var refreshIntervalId2;
	   numberMessages = 0;
	   
	   refreshIntervalId1 = setInterval(function(){
		   console.log("inside first function");
		   var myEle = document.getElementsByClassName("LPMcontainer")[0];
		   if(myEle){
			   console.log("button presented");
			   clearInterval(refreshIntervalId1);
			   clearInterval(refreshIntervalId2);
			   $('.LPMcontainer').click(function(){
				   console.log("button clicked");
				   sessionWebChat = true;
				   ButtonClicked();
			   });
		   }
	   }, 500);
	   
	   refreshIntervalId2 = setInterval(function(){
		   console.log("inside first function");
		   var myEle = document.getElementsByClassName("lp_close")[0];
		   if(myEle){
			   console.log("button presented");
			   clearInterval(refreshIntervalId1);
			   clearInterval(refreshIntervalId2);
			   console.log("chat already open");
			   sessionWebChat = true;
			   ButtonClicked();	   

		   }
	   }, 500);
	   	

	   
	   
   }
	  
	  
   var sessionWebChat = false;
   var numberMessages = 0;
   startMonitoring();
   
  </script>
  
  

 	
   <button id ="submit" class="web-button" type="button" onclick="showResult()">Completa Ordine</button>
 
 
</body>
  

  
</html>
